<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
      layout:decorate="~{layouts/default}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Form</title>
</head>
<body>
<div layout:fragment="content">
    <h2>Login</h2>

    <form id="loginForm" th:action="@{/auth/login}" th:object="${requestDto}" method="post">
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" th:field="*{email}" required> <!-- 로그인 폼의 email 필드 -->
        </div>

        <div>
            <label for="password">Password:</label>
            <input type="password" id="password" th:field="*{password}" required> <!-- 로그인 폼의 password 필드 -->
        </div>

        <button type="submit">Login</button> <!-- 로그인 버튼 -->
    </form>
    <!-- 로그인 폼 끝 -->

    <div id="errorMessage" class="mt-3" style="color: red; display: none;">
        Invalid credentials, please try again.
    </div>
<script>
    document.getElementById("loginForm").onsubmit = function(event) {
        event.preventDefault(); // 폼 제출 기본 동작을 막음
        var userEmail = document.getElementById("email").value; // 수정된 부분
        var userPwd = document.getElementById("password").value; // 수정된 부분

        // fetch를 사용하여 AJAX 요청을 보냄
        fetch("/auth/login", { // 수정된 부분
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                email: document.getElementById('email').value,
                password: document.getElementById('password').value
            })
        })
        .then(response => {
            if (response.ok) {
                return response.json(); // 토큰을 포함한 JSON 응답을 받음
            } else {
                throw new Error("Invalid credentials");
            }
        })
        .then(data => {
            console.log("Access Token:", data.accessToken);
            console.log("Refresh Token:", data.refreshToken);
            // 로그인 성공 시, 다른 페이지로 리다이렉트하거나, 세션 관리 등을 처리
            window.location.href = "/"; // 예시: 로그인 후 홈 페이지로 이동
        })
        .catch(error => {
            // 로그인 실패 시, 오류 메시지 표시
            document.getElementById("errorMessage").style.display = "block";
        });
    };
</script>
</div>
</body>
</html>