<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts</title>
</head>
<body>
    <h1>게시글 목록</h1>

    <form method="get" action="/posts">
        <!-- 상위 카테고리 선택 (페이지 렌더링 시 미리 로드된 데이터 사용) -->
<!--        <select id="parentCategorySelect" name="parentCategoryId">-->
<!--            <option value="">상위 카테고리 선택</option>-->
<!--            <option th:each="parent : ${parentCategories}"-->
<!--                    th:value="${parent.categoryId}"-->
<!--                    th:text="${parent.categoryName}"></option>-->
<!--        </select>-->

<!--        &lt;!&ndash; 하위 카테고리 선택 (서버에서 전달된 하위 카테고리 목록 사용) &ndash;&gt;-->
<!--        <select id="childCategorySelect" name="childCategoryId">-->
<!--            <option value="">하위 카테고리 선택</option>-->
<!--            <option th:each="child : ${childCategories}"-->
<!--                    th:value="${child.categoryId}"-->
<!--                    th:text="${child.categoryName}"></option>-->
<!--        </select>-->
        <label for="parentCategorySelect">Parent Category</label>
        <select id="parentCategorySelect" name="parentCategoryId" onchange="updateChildCategories(this.value)">
            <option value="-1">상위 카테고리 선택</option>
            <!-- 부모 카테고리 목록 -->
            <th:block th:each="parentCategory : ${parentCategories}">
                <option th:value="${parentCategory.categoryId}" th:text="${parentCategory.categoryName}"></option>
            </th:block>
        </select>

        <!-- 하위 카테고리 선택 -->
        <label for="childCategorySelect">Child Category</label>
        <select id="childCategorySelect" name="childCategoryId">
            <option value="">하위 카테고리 선택</option>
            <!-- 하위 카테고리 목록은 부모 카테고리 선택 후 동적으로 변경됨 -->
            <th:block th:each="childCategory : ${childCategories}">
                <option th:value="${childCategory.categoryId}" th:text="${childCategory.categoryName}"></option>
            </th:block>
        </select>

        <!-- 플랫폼 선택 -->
        <select id="platform" name="platformId">
            <option value="">플랫폼 선택</option>
            <option th:each="platform : ${platforms}"
                    th:value="${platform.platformId}"
                    th:text="${platform.platformName}"></option>
        </select>

        <!-- 언어 선택 -->
        <select id="language" name="languageId">
            <option value="">언어 선택</option>
            <option th:each="language : ${languages}"
                    th:value="${language.languageId}"
                    th:text="${language.languageName}"></option>
        </select>

        <!-- 검색 버튼 -->
        <button type="submit">검색</button>
    </form>

    <div id="postList">
        <ul>
            <li th:each="post : ${posts}">
                <a th:href="@{/posts/{postId}(postId=${post.postId})}" th:text="${post.postTitle}"></a>
                <p th:text="'작성자: ' + ${post.userNickname}"></p>
                <p th:text="'카테고리: ' + ${post.parentCategoryName} + ' > ' + ${post.childCategoryName}"></p>
                <p th:text="'플랫폼: ' + ${post.platformName}"></p>
                <p th:text="'언어: ' + ${post.languageName}"></p>
                <p th:text="'좋아요 수: ' + ${post.postLikeCount}"></p>
                <p th:text="'작성일: ' + ${post.postCreatedAt}"></p>
            </li>
        </ul>
    </div>
    <script>
        function updateChildCategories(parentCategoryId) {
            if (parentCategoryId != -1) {
                fetch(`/posts/categories/${parentCategoryId}`)
                    .then(response => response.json())
                    .then(data => {
                        const childCategorySelect = document.getElementById('childCategorySelect');
                        childCategorySelect.innerHTML = '<option value="">Select Child Category</option>';
                        data.forEach(childCategory => {
                            const option = document.createElement('option');
                            option.value = childCategory.categoryId;
                            option.textContent = childCategory.categoryName;
                            childCategorySelect.appendChild(option);
                        });
                    })
                    .catch(error => console.error('Error loading child categories:', error));
            } else {
                const childCategorySelect = document.getElementById('childCategorySelect');
                childCategorySelect.innerHTML = '<option value="">Select Child Category</option>';
            }
        }
    </script>


    <!-- 자바스크립트: 상위 카테고리 선택 시 하위 카테고리 동적 로드 -->
<!--    <script>-->
<!--        $(document).ready(function() {-->
<!--            $('#parentCategorySelect').change(function() {-->
<!--                var parentId = $(this).val();-->
<!--                if (parentId) {-->
<!--                    $.get('/posts/categories/' + parentId, function(childCategories) {-->
<!--                        .done(function(childCategories) {-->
<!--                              $('#childCategorySelect').empty();-->
<!--                              $('#childCategorySelect').append('<option value="">하위 카테고리 선택</option>');-->
<!--                              $.each(childCategories, function(index, category) {-->
<!--                                  $('#childCategorySelect').append(-->
<!--                                      '<option value="' + category.categoryId + '">' + category.categoryName + '</option>'-->
<!--                                  );-->
<!--                              });-->
<!--                    }).fail(function() {-->
<!--                        alert('하위 카테고리를 불러오는 데 실패했습니다.');-->
<!--                    });-->
<!--                } else {-->
<!--                    $('#childCategorySelect').empty().append('<option value="">하위 카테고리 선택</option>');-->
<!--                }-->
<!--            });-->
<!--        });-->
<!--    </script>-->

</body>
</html>